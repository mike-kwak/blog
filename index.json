[{"categories":["java","spring"],"contents":"ìŠ¤í”„ë§ ë‚´ì—ì„  RestTemplateë€ ê°ì²´ê°€ ì¡´ì¬í•´ HTTP ìš”ì²­ì„ ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ RestTemplateë¥¼ ìš”ì²­ ì‹œ ìƒì„±í•´ì„œ ì‚¬ìš©í•˜ê±°ë‚˜ í•˜ëŠ” ì˜ëª»ëœ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤. RestTemplate ë‚´ HTTP Client ì¢…ë¥˜ì™€ ì„¤ëª…, Bean ë“±ë¡ ì„¤ì •ê¹Œì§€ í•´ë³´ê³ , RequestEntity ê°ì²´ë¥¼ í†µí•´ ì½”ë“œ ê°€ë…ì„± ì¢‹ê²Œ ìš”ì²­í•˜ëŠ” ë°©ë²•ê³¼ ë²ˆì™¸ë¡œ URIë¥¼ í…œí”Œë¦¿í™” í•˜ì—¬ ì‘ì„±í•  ìˆ˜ ìˆëŠ” UriComponentsBuilder í´ë˜ìŠ¤ ì‚¬ìš©ë²•ê¹Œì§€ ì‘ì„±í•´ ë³´ì•˜ë‹¤.\n   RestTemplate í´ë˜ìŠ¤ ë° ì‚¬ìš©ìš©ë„   Spring RestTemplate JavaDoc (Spring Framework 3.0 ì´ìƒ)  HTTP ìš”ì²­ ì‹œ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤. ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë©”ì†Œë“œë¥¼ ì‚´í´ë³´ë©´ ë§ì€ ë©”ì†Œë“œë“¤ì´ í¼ì³ì ¸ ìˆë‹¤. ê°ê°ì˜ HTTP Methodë§ˆë‹¤ ì¡´ì¬í•˜ê³  ë§¤ê°œë³€ìˆ˜ì— ë”°ë¼ ì—¬ëŸ¬ ë©”ì†Œë“œë“¤ì„ ê³¨ë¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ HTTP Methodì™€ URLë§Œ í•´ë„ ê°„ë‹¨í•˜ì§€ ì•Šë‹¤. ë”°ë¼ì„œ ì•„ë˜ì˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.\n  exchange(RequestEntity\u0026lt;?\u0026gt;Â entity, Class\u0026lt;T\u0026gt;Â responseType)\n  exchange(RequestEntity\u0026lt;?\u0026gt;Â entity, ParameterizedTypeReference\u0026lt;T\u0026gt;Â responseType)\n  ì´ ë‘ê°œì˜ ë©”ì†Œë“œì˜ ì°¨ì´ëŠ” ë’¤ì˜ íƒ€ì… ì •ë³´ ì „ë‹¬ì˜ ì°¨ì´ê°€ ì¡´ì¬í•œë‹¤. ì²«ë²ˆì§¸ Classíƒ€ì…ì€ í‰ìƒì‹œì— ì‚¬ìš©í•˜ë©´ ë˜ì§€ë§Œ, ë§Œì•½ ì œë„¤ë¦­ íƒ€ì…ì„ ë°›ì•„ì•¼ í• ë•ŒëŠ” ë‘ë²ˆì§¸ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ìì„¸í•œ ì‚¬ìš© ë°©ë²•ì€ ì•„ë˜ RestTemplate ì˜ ì‚¬ìš©í•˜ê¸°ì—ì„œ ì‚´í´ë³´ê² ë‹¤.\nì´ RestTemplateë¥¼ ê·¸ëƒ¥ newë¡œ ìƒì„± í–ˆì„ ë• ìë°”ì— ë‚´ì¥ëœ HttpUrlConnection í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤. JDK 1.1ë¶€í„° ì‚¬ìš©ë˜ì—ˆê³ , ë²„ì „ì—…í•˜ë©° í¬ê²Œ ê°œì„ ëœ ê±´ ì—†ì–´ ë‹¨ìˆœíˆ ì—°ê²° í›„ ìš”ì²­í•˜ê³  ì‘ë‹µí•˜ëŠ” ì•¡ì…˜ë§Œ ì²˜ë¦¬í•  ë¿ì´ë‹¤. ì»¤ë„¥ì…˜ ë°©ë²•ì¸ Connection: keep-aliveë‚˜ HTTP/2ì™€ ê°™ì€ í”„ë¡œí† ì½œì—ì„œì˜ ì†ë„ ê°œì„ ì‚¬í•­ì„ ì ìš©ë°›ì„ ìˆ˜ ì—†ë‹¤.\n   HTTP Client ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ RestTemplateì— ë“±ë¡ ë° Bean ì„¤ì •  ìš°ë¦¬ëŠ” ë‘ê°€ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.\n  OkHttp\n  HTTP/2 ì§€ì›.\n  Androidì—ì„œ HTTP ìš”ì²­ ì‹œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ Retrofitì´ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬.\n  ì½”í‹€ë¦° ì½”ë“œë¡œ ì‘ì„±ë˜ì–´ ì½”í‹€ë¦° ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì˜ì¡´ì„±ì— í¬í•¨.\n    Apache HttpComponents\n  ìë°”ë¡œ ì‘ì„±ë¨.\n  ì˜¤ë«ë™ì•ˆ ê²€ì¦ëœ Apache Commonsì—ì„œ ë¶„ë¦¬í•œ í”„ë¡œì íŠ¸.\n  ë²„ì „ 4ëŠ” HTTP/1.1ê¹Œì§€ ì§€ì›.\n    ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí–ˆë‹¤ë©´ Spring Boot 2.x ê¸°ì¤€ìœ¼ë¡œ ì„¤ì • ë°©ë²•ì„ ì„¤ëª…í•˜ê² ë‹¤.\n   OkHttp ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì • ë°©ë²•    Maven Central ê²€ìƒ‰ ì‚¬ì´íŠ¸\n  ì•„ë˜ ì½”ë“œë¥¼ ë°”ë¡œ ì…ë ¥í•˜ê¸° ë³´ë‹¤, Maven ê²€ìƒ‰ ì‚¬ì´íŠ¸ì—ì„œ ìµœì‹  ë²„ì „ì„ ì‚´í´ë³´ê³  ì œê³µí•˜ëŠ” ì½”ë“œë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.\n  í˜„ì¬ OkHttp 5 alpha ë²„ì „ì´ ë“±ë¡ë˜ê³  ìˆì§€ë§Œ í˜¸í™˜ì„±ì„ ë‹´ë³´í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìµœì‹ ì˜ 4.x.x ë²„ì „ì„ ì‚¬ìš© ê¶Œì¥í•œë‹¤.\n    Maven\n1 2 3 4 5  \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.squareup.okhttp3\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;okhttp\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.9.2\u0026lt;!-- 2021/10 ê¸°ì¤€ ìµœì‹ ë²„ì „ --\u0026gt;\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt;     Gradle\n1  implementation \u0026#39;com.squareup.okhttp3:okhttp:4.9.2\u0026#39;        Apache HttpComponents ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì • ë°©ë²•    ì£¼ì˜! HttpComponents 5 ì´ìƒ ë²„ì „ì€ Spring Framework 5.3 ì—ì„œ ì‚¬ì „ ì„¤ì •ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ!\n ë§Œì•½ ì§ì ‘ ì‚¬ìš© ì‹œì—” ClientHttpRequestFactory ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ í´ë˜ìŠ¤ êµ¬í˜„.    Maven Central ê²€ìƒ‰ ì‚¬ì´íŠ¸\n ì•„ë˜ ì½”ë“œë¥¼ ë°”ë¡œ ì…ë ¥í•˜ê¸° ë³´ë‹¤, Maven ê²€ìƒ‰ ì‚¬ì´íŠ¸ì—ì„œ ìµœì‹  ë²„ì „ì„ ì‚´í´ë³´ê³  ì œê³µí•˜ëŠ” ì½”ë“œë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.    Maven\n1 2 3 4 5  \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.httpcomponents\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;httpclient\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.5.13\u0026lt;!-- 2021/10 ê¸°ì¤€ ìµœì‹ ë²„ì „ --\u0026gt;\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt;     Gradle\n1  implementation \u0026#39;org.apache.httpcomponents:httpclient:4.5.13\u0026#39;        HttpClientConfiguration ì„¤ì • ì½”ë“œ  ìœ„ OkHttpì™€ HttpComponents ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì • ì‹œì— Spring Bootì—ì„œ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ê°€ ìˆë‹¤. RestTemplateBuilder í´ë˜ìŠ¤ì´ë‹¤.\n Spring Boot RestTemplateBuilder JavaDoc  ì´ í´ë˜ìŠ¤ëŠ” ì´ë¯¸ Spring Bootë¥¼ ì‚¬ìš© í•˜ê³  ìˆë‹¤ë©´, RestTemplateAutoConfigurationì— ì˜í•´ Beanìœ¼ë¡œ ì„¤ì •ë˜ì–´ìˆë‹¤. ì´ë¯¸ ì„¤ì •ëœ MessageConverterê°€ í¬í•¨ëœ ìƒíƒœì´ë¯€ë¡œ RestTemplateBuilder Beanì„ ë°›ì•„ build() ë©”ì†Œë“œë¡œ RestTemplate í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ Beanìœ¼ë¡œ ë“±ë¡í•˜ë©´ ëœë‹¤.\n  OkHttp ì‚¬ìš© ì‹œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  import okhttp3.OkHttpClient; import org.springframework.boot.web.client.RestTemplateBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.http.client.OkHttp3ClientHttpRequestFactory; import org.springframework.web.client.RestTemplate; @Configuration public class HttpClientConfiguration { @Bean public RestTemplate restTemplate(RestTemplateBuilder restTemplateBuilder) { return restTemplateBuilder .requestFactory(() -\u0026gt; new OkHttp3ClientHttpRequestFactory(new OkHttpClient())) .build(); } }     Apache HttpComponents 4 ì‚¬ìš© ì‹œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  import org.apache.http.client.HttpClient; import org.apache.http.impl.client.HttpClients; import org.springframework.boot.web.client.RestTemplateBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.http.client.HttpComponentsClientHttpRequestFactory; import org.springframework.web.client.RestTemplate; @Configuration public class HttpClientConfiguration { @Bean public RestTemplate restTemplate(RestTemplateBuilder restTemplateBuilder) { return restTemplateBuilder .requestFactory(() -\u0026gt; new HttpComponentsClientHttpRequestFactory(HttpClients.createDefault())) .build(); } }     ë§Œì•½, Spring Boot ê¸°ë°˜ì´ ì•„ë‹Œ êµ¬ ë²„ì „ ì‚¬ìš©ìëŠ” RestTemplateë¥¼ newë¡œ ìƒì„± í›„ ë“±ë¡í•  ìˆ˜ë„ ìˆë‹¤.\n  OkHttp ì‚¬ìš© ì‹œ (Spring Framework 4.3 ì´ìƒ)\n1 2 3 4 5 6 7 8 9 10 11 12  import okhttp3.OkHttpClient; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.http.client.OkHttp3ClientHttpRequestFactory; import org.springframework.web.client.RestTemplate; ... @Bean public RestTemplate restTemplate() { return new RestTemplate(new OkHttp3ClientHttpRequestFactory(new OkHttpClient())); }     Apache HttpComponents 4 ì‚¬ìš© ì‹œ (Spring Framework 4.0 ì´ìƒ ê¶Œì¥)\n1 2 3 4 5 6 7 8 9 10 11 12 13  import org.apache.http.client.HttpClient; import org.apache.http.impl.client.HttpClients; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.http.client.HttpComponentsClientHttpRequestFactory; import org.springframework.web.client.RestTemplate; ... @Bean public RestTemplate restTemplate() { return new RestTemplate(new HttpComponentsClientHttpRequestFactory(HttpClients.createDefault()); }        Interceptor êµ¬í˜„ ë° ë“±ë¡  RestTemplateì„ í†µí•´ ìš”ì²­ ì „, í›„ë¡œ ì–´ë– í•œ ì‘ì—…ì„ í•˜ê³  ì‹¶ë‹¤ë©´, ClientHttpRequestInterceptor ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ ë¶™ì´ë©´ ëœë‹¤. íŠ¹íˆ ë°˜ë³µì ìœ¼ë¡œ ì¸ì¦ í—¤ë”ë¥¼ ë¶™ì¸ë‹¤ë˜ì§€, ìš”ì²­ ë¡œê·¸ë¥¼ ì°ì„ ë•Œ ìœ ìš©í•˜ë‹¤.\n ClientHttpRequestInterceptor JavaDoc  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  ... import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.http.client.ClientHttpRequestInterceptor; import org.springframework.http.client.ClientHttpResponse; import org.springframework.util.StreamUtils; import java.nio.charset.StandardCharsets; ... private static final Logger log = LoggerFactory.getLogger(HttpClientConfiguration.class); @Bean public RestTemplate restTemplate(RestTemplateBuilder restTemplateBuilder) { return restTemplateBuilder .requestFactory(() -\u0026gt; new OkHttp3ClientHttpRequestFactory(new OkHttpClient())) .interceptors(loggingInterceptor()) .build(); } private ClientHttpRequestInterceptor loggingInterceptor() { return (req, reqBody, execution) -\u0026gt; { // HTTP Request ë¡œê·¸  if (log.isDebugEnabled()) { log.debug(\u0026#34;req {} {}, body: {}\u0026#34;, req.getMethodValue(), req.getURI(), new String(reqBody, StandardCharsets.UTF_8)); } // HTTP ìš”ì²­ ì‹¤í–‰  ClientHttpResponse res = execution.execute(req, reqBody); // HTTP Response ë¡œê·¸  if (log.isDebugEnabled()) { log.debug(\u0026#34;res {}, body: {}\u0026#34;, res.getRawStatusCode(), StreamUtils.copyToString(res.getBody(), StandardCharsets.UTF_8)); } return res; }; }   ìœ„ì™€ ê°™ì€ ì½”ë“œë¡œ ì¸í„°í˜ì´ìŠ¤ ë‚´ì— ë©”ì†Œë“œëŠ” í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì—, ëŒë‹¤ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  RestTemplate Bean ìƒì„± ì‹œì— ì¸í„°ì…‰í„°ë¥¼ ì‚½ì…í•´ì¤„ ìˆ˜ ìˆë‹¤.\në¬¸ì œëŠ” ClientHttpRequestInterceptor ë‚´ ì‘ë‹µ InputStreamì„ í˜„ì¬ ìƒíƒœì—ì„œ êµ¬í˜„ í›„ ì‚¬ìš© ì‹œ ì¸í„°ì…‰í„° ë‚´ì—ì„œëŠ” ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ë§Œ, ì‹¤ì œë¡œ RestTemplate ê°ì²´ë¥¼ ì‚¬ìš©í•œ ê³³ì— ë¦¬í„´ ê°’ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì˜ˆì™¸ê°€ ë˜ì €ì§€ê±°ë‚˜ ê°ì²´ ë‚´ ê°’ë“¤ì´ nullì¼ ìˆ˜ ìˆë‹¤. ê·¸ ì´ìœ ëŠ” ì¸í„°ì…‰í„° ë‚´ì˜ InputStreamì´ í•œë²ˆ ì‚¬ìš©í•˜ë©´ ìŠ¤íŠ¸ë¦¼ì´ ì†Œëª¨ë˜ì–´ ë‹¤ì‹œ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.\nê·¸ë˜ì„œ í•„ìš”í•œ ê²ƒì´ BufferingClientHttpRequestFactory í´ë˜ìŠ¤ì´ë‹¤. ì´ í´ë˜ìŠ¤ëŠ” Bufferingì´ ë¶™ì€ ë§Œí¼ InputStreamì„ ì‚¬ìš©í•´ë„ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ”ë‹¤.\n BufferingClientHttpRequestFactory JavaDoc  ì´ í´ë˜ìŠ¤ì˜ ìƒì„±ìëŠ” ê°„ë‹¨í•˜ê²Œ ìš°ë¦¬ê°€ ì‹¤ì œ ì‚¬ìš©í•  ClientHttpRequestFactory ê°ì²´ë¥¼ í•œë²ˆ ê°ì‹¸ì£¼ë©´ ëœë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12  ... import org.springframework.http.client.BufferingClientHttpRequestFactory; ... @Bean public RestTemplate restTemplate(RestTemplateBuilder restTemplateBuilder) { return restTemplateBuilder .requestFactory(() -\u0026gt; new BufferingClientHttpRequestFactory( new OkHttp3ClientHttpRequestFactory(new OkHttpClient()) )) .build(); }      RestTemplate ì˜ ì‚¬ìš©í•˜ê¸°  ë¨¼ì € RestTemplate ì‚¬ìš© ì‹œì—” newë¡œ ìƒì„±í•˜ëŠ” ê²ƒë³´ë‹¤, ìœ„ì—ì„œ Bean ë“±ë¡í•œ ê°ì²´ë¥¼ Autowired ë˜ëŠ” ìƒì„±ìë¡œ í•„ë“œ ì„ ì–¸í•˜ì—¬ Bean ê°ì²´ë¥¼ ì˜ì¡´ ì£¼ì…ìœ¼ë¡œ ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.\n1 2  @Autowired private RestTemplate restTemplate;   ìœ„ì—ì„œ ë‘ exchange ë©”ì†Œë“œë¥¼ ì–¸ê¸‰í–ˆì—ˆë‹¤.\n  exchange(RequestEntity\u0026lt;?\u0026gt;Â entity, Class\u0026lt;T\u0026gt;Â responseType)\n  exchange(RequestEntity\u0026lt;?\u0026gt;Â entity, ParameterizedTypeReference\u0026lt;T\u0026gt;Â responseType)\n  ì´ ë©”ì†Œë“œë¥¼ ì´ìš©í•´ HTTP ìš”ì²­ì„ ë³´ë‚´ê³  ë°›ëŠ” ì½”ë“œ ì˜ˆì œë¥¼ ë³´ì—¬ì¤„ ê²ƒì´ë‹¤. ì´ ë‘ ë©”ì†Œë“œì˜ ì°¨ì´ëŠ” ë¦¬í„´ íƒ€ì…ì„ ë°›ëŠ” í˜•íƒœì˜ ì°¨ì´ì´ë‹¤. ìœ„ì˜ í´ë˜ìŠ¤ íƒ€ì…ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” ë©”ì†Œë“œëŠ” ê°„ë‹¨í•œ String.class, byte[].class, ì œë„¤ë¦­ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ëª¨ë“  í´ë˜ìŠ¤ íƒ€ì…ì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\në§Œì•½ Map, Listë‚˜ ê¸°íƒ€ ì»¬ë ‰ì…˜ë¥˜, ì œë„¤ë¦­ í´ë˜ìŠ¤ì¼ ê²½ìš°ì—” ì•„ë˜ì˜ ParameterizedTypeReference í´ë˜ìŠ¤ë¥¼ ê°ì²´ë¡œ ìƒì„±í•˜ì—¬ íƒ€ì…ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œ ParameterizedTypeReference\u0026lt;T\u0026gt; ìƒì„±ìëŠ” protectedì´ì§€ë§Œ ìµëª… ê°ì²´ë¡œ ì•„ë¬´ëŸ° êµ¬í˜„ ì—†ì´ ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•  ìˆ˜ ìˆë‹¤.\n1  new ParameterizedTypeReference\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt;() {}    Spring RequestEntity JavaDoc (Spring Framework 4.1 ì´ìƒ)  ë©”ì†Œë“œì—ì„œ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” RequestEntityëŠ” HttpEntityì˜ ìì‹ í´ë˜ìŠ¤ë¡œ, ë‹¤ìš©ë„ë¡œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤. íŠ¹íˆ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë§¤ê°œë³€ìˆ˜ë¡œ ì„ ì–¸ ì‹œ ìš”ì²­ ë°ì´í„°ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\n1 2 3 4  @PostMapping(\u0026#34;/post\u0026#34;) public void post(RequestEntity\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; request) { ... }   ì—¬ê¸°ì„œëŠ” RestTemplateì˜ ìš”ì²­ ê°ì²´ë¡œ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì•„ë˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œì´ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11  import org.springframework.core.ParameterizedTypeReference; import org.springframework.http.RequestEntity; import java.net.URI; ... private Map\u0026lt;String, Object\u0026gt; request() { RequestEntity\u0026lt;Void\u0026gt; request = RequestEntity.get(URI.create(\u0026#34;https://httpbin.org/anything\u0026#34;)).build(); return restTemplate.exchange(request, new ParameterizedTypeReference\u0026lt;\u0026gt;() {}).getBody(); }   ì¡°ê¸ˆ ë” ë³µì¡í•œ ì˜ˆì œì¸ ì•„ë˜ì™€ ê°™ì€ í˜•íƒœì˜ JSON ë¬¸ì„œë¥¼ POST ìš”ì²­ í•˜ëŠ” ê²ƒì„ í•´ë³´ì.\n1 2 3 4 5 6  { \u0026#34;send_id\u0026#34;: 1, \u0026#34;message\u0026#34;: \u0026#34;Hello, Mike!\u0026#34;, \u0026#34;receiver\u0026#34;: [\u0026#34;mike\u0026#34;, \u0026#34;anonymous\u0026#34;], \u0026#34;is_beep\u0026#34;: true }   ì´ëŸ¬í•œ JSON ê°ì²´ë¥¼ ìš”ì²­í•˜ê³  ì‘ë‹µí•˜ëŠ” ë©”ì†Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  import org.springframework.core.ParameterizedTypeReference; import org.springframework.http.RequestEntity; import java.net.URI; import java.util.Arrays; import java.util.Map; import java.util.HashMap; ... private Map\u0026lt;String, Object\u0026gt; request() { Map\u0026lt;String, Object\u0026gt; requestBodyMap = new HashMap\u0026lt;\u0026gt;(); requestBodyMap.put(\u0026#34;send_id\u0026#34;, 1); requestBodyMap.put(\u0026#34;message\u0026#34;, \u0026#34;Hello, Mike!\u0026#34;); requestBodyMap.put(\u0026#34;receiver\u0026#34;, Arrays.asList(\u0026#34;mike\u0026#34;, \u0026#34;anonymous\u0026#34;)); requestBodyMap.put(\u0026#34;is_beep\u0026#34;, true); RequestEntity\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; request = RequestEntity.post(URI.create(\u0026#34;https://httpbin.org/anything\u0026#34;)) .body(requestBodyMap); return restTemplate.exchange(request, new ParameterizedTypeReference\u0026lt;\u0026gt;() {}).getBody(); }   ê°„ë‹¨í•œ í˜•íƒœëŠ” Map\u0026lt;String, Object\u0026gt; íƒ€ì…ìœ¼ë¡œ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆê³ , ë³µì¡í•œ í˜•íƒœëŠ” Value Object í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.\n   Exception  RestTemplate ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ HTTP ìš”ì²­ í›„ ì‘ë‹µ ìƒíƒœê°€ ë§Œì•½ 4XXë¥¼ ë°›ê²Œ ëœë‹¤ë©´, HttpClientErrorException ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤. 5XXì¼ ê²½ìš°ì—” HttpServerErrorException ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤. ì´ ë‘ ì˜ˆì™¸ í´ë˜ìŠ¤ëŠ” HttpStatusCodeExceptionì˜ ìì‹ í´ë˜ìŠ¤ì´ë‹¤. ì‚¬ì‹¤ ì´ ì˜ˆì™¸ í´ë˜ìŠ¤ë“¤ì€ ê³„ì¸µ ê´€ê³„ê°€ ë³µì¡í•œë°, ì—¬ëŸ¬ê°€ì§€ ì˜ˆì™¸ í˜•íƒœë¥¼ ë¬¶ë‹¤ë³´ë‹ˆ ìƒê¸´ ì¼ì¸ ë“¯ í•˜ë‹¤.\në˜í•œ RestTemplate ì‚¬ìš© ì¤‘ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ëŠ” RestClientExceptionì˜ í•˜ìœ„ í´ë˜ìŠ¤ì´ë‹¤.\n  RestClientException (Spring 3.0 ì´ìƒ)\n ëª¨ë“  RestTemplateì˜ Exception ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•œë‹¤. HTTP ì‘ë‹µ ì—ëŸ¬ ë¿ë§Œ ì•„ë‹ˆë¼ I/O ì—ëŸ¬, JSON ì´ë‚˜ XML í¬ë©§ ë“±ì„ ì²˜ë¦¬ í•˜ê¸° ìœ„í•œ MessageConverter ì‘ë™ ì¤‘ ì—ëŸ¬ ë“± ëª¨ë‘ë¥¼ í¬í•¨í•œë‹¤.    RestClientResponseException (Spring 4.3 ì´ìƒ)\n HTTP ì‘ë‹µ ì—ëŸ¬ë¥¼ ìœ„í•œ ì˜ˆì™¸ í´ë˜ìŠ¤ì´ë‹¤. ëª¨ë“  ì‘ë‹µ ìƒíƒœë¥¼ ì¡ìœ¼ë ¤ë©´ ì´ ì˜ˆì™¸ ë°œìƒ ê°ì²´ë¥¼ ì²˜ë¦¬í•˜ë©´ ëœë‹¤.    UnknownHttpStatusCodeException (Spring 4.2 ì´ìƒ)\n HTTP ì‘ë‹µ ì—ëŸ¬ ì¤‘ í‘œì¤€ì´ ì•„ë‹Œ ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µ ìƒíƒœì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ í´ë˜ìŠ¤ì´ë‹¤.    HttpStatusCodeException (Spring 3.0 ì´ìƒ)\n HTTP ì‘ë‹µ ì—ëŸ¬ ì¤‘ ì•Œë ¤ì§„ ì‘ë‹µ ìƒíƒœì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ í´ë˜ìŠ¤ì´ë‹¤.    HttpClientErrorException (Spring 3.0 ì´ìƒ)\n HTTP 4XX Client Error ì‘ë‹µ ì‹œì— ë˜ì ¸ì§€ëŠ” ì˜ˆì™¸ í´ë˜ìŠ¤ì´ë‹¤.    HttpServerErrorException (Spring 3.0 ì´ìƒ)\n HTTP 5XX Server Error ì‘ë‹µ ì‹œì— ë˜ì ¸ì§€ëŠ” ì˜ˆì™¸ í´ë˜ìŠ¤ì´ë‹¤.    ìœ„ì™€ ê°™ì€ ì˜ˆì™¸ í´ë˜ìŠ¤ ê³„ì¸µì´ ì¡´ì¬í•˜ë©°, í•„ìš”í•œ ëª©ì ì— ë”°ë¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë³´í†µì€ RestClientResponseException íƒ€ì…ë§Œ catchí•´ì„œ ì‚¬ìš©í•˜ë©´ ì‘ë‹µí•˜ëŠ” ëª¨ë“  ìƒíƒœì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.\n   ë²ˆì™¸, UriComponentBuilder  URI.create(String uri) ì •ì  ìƒì„± ë©”ì†Œë“œëŠ” ë¬¸ìì—´ë¡œ ê°„ë‹¨í•˜ê²Œ URI ê°ì²´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆì§€ë§Œ ë§¤ê°œë³€ìˆ˜ ë¬¸ìì—´ì´ ì˜ëª»ëœ í˜•ì‹ì¼ ë•Œ URISyntaxException ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ëŠ” ìœ„í—˜ì´ ì¡´ì¬í•˜ê³ , URI í˜•íƒœê°€ ë¹„ìŠ·í•˜ë©´ì„œ ì–´ë– í•œ ê²½ë¡œë‚˜ ì¿¼ë¦¬ ë³€ìˆ˜ë§Œ ë‹¤ë¥´ê²Œ í…œí”Œë¦¿í™” ì‹œí‚¤ê³  ì‹¶ë‹¤ë©´ ë¬¸ìì—´ë¡œ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ í•˜ë“œì½”ë”©ì´ ë  ìˆ˜ ìˆë‹¤.\nê·¸ë˜ì„œ ì•ˆì „í•˜ê³  í…œí”Œë¦¿ í˜•íƒœë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” UriComponentsBuilder í´ë˜ìŠ¤ì™€ UriComponents í´ë˜ìŠ¤ ë‘ê°œì˜ ì‚¬ìš©ë²•ì„ ê°„ë‹¨íˆ ì†Œê°œí•œë‹¤.\n Spring UriComponentsBuilder JavaDoc Spring UriComponents JavaDoc JDK java.net.URI JavaDoc  UriComponentsBuilder í´ë˜ìŠ¤ëŠ” new ìƒì„±ìê°€ ì•„ë‹Œ, ì •ì  ìƒì„± ë©”ì„œë“œê°€ ëª‡ê°€ì§€ ì¡´ì¬í•œë‹¤.\n  fromHttpUrl(String httpUrl)\n ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì£¼ì†Œì°½ì˜ URLì„ ë¬¸ìì—´ë¡œ ë°›ëŠ”ë‹¤. https://www.google.com/search?q=resttemplate ê³¼ ê°™ì€ í˜•íƒœ.    fromPath(String path)\n í”„ë¡œí† ì½œì´ë‚˜ ë„ë©”ì¸ì´ ë¹ ì§„ ê²½ë¡œ í˜•íƒœì˜ ë¬¸ìì—´ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. /auth/tokens ì™€ ê°™ì€ í˜•íƒœ {variable}ê³¼ ê°™ì´ í…œí”Œë¦¿ì„ ìœ„í•œ ë³€ìˆ˜ ì„¤ì •ë„ ê°€ëŠ¥í•˜ë‹¤.    fromUri(URI uri)\n java.net.URI ê°ì²´ë¥¼ ë°›ëŠ” í˜•íƒœ    fromUriString(String uri)\n URIì˜ ë¬¸ìì—´ í˜•íƒœë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. URIëŠ” ì›¹ ì£¼ì†Œ ë¿ë§Œ ì•„ë‹ˆë¼ tel:+82-2-0000-0000, mailto:someone@example.com?subject=hello ê°™ì€ í˜•íƒœë„ ê°€ëŠ¥.    newInstance()\n ì•„ë¬´ëŸ° ë§¤ê°œë³€ìˆ˜ ì—†ì´ ì¼ë‹¨ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.    ê¸°íƒ€ ë‹¤ë¥¸ ë©”ì†Œë“œëŠ” JavaDoc ì°¸ì¡°\n  ì •ì  ìƒì„± ë©”ì„œë“œë¥¼ ë§¤ê°œë¡œ Builder íŒ¨í„´ìœ¼ë¡œ í•„ìš”í•œ ê²ƒì„ ë¶™ì—¬ê°€ë©° ê°ì²´ ìƒì„±ì´ ê°€ëŠ¥í•˜ë‹¤. ì£¼ìš” ë¹Œë” ë©”ì„œë“œë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.\n  scheme(String scheme), host(String host), port(int port)\n schemeëŠ” http, https, ftpì™€ ê°™ì€ í”„ë¡œí† ì½œì´ ë  ìˆ˜ ìˆë‹¤. ë˜ëŠ” tel, mailtoì™€ ê°™ì€ ì •ë³´ ë‹¨ìœ„ì¼ ìˆ˜ ìˆë‹¤. hostëŠ” google.com, youtube.com, 127.0.0.1ê³¼ ê°™ì€ ipë‚˜ hostname ì´ë‹¤. portëŠ” í”„ë¡œí† ì½œ í†µì‹  ì‹œ HTTP 80, HTTPS 443ê³¼ ê°™ì€ ê¸°ë³¸ í¬íŠ¸ê°€ ì•„ë‹ ì‹œ ì§€ì •í•œë‹¤.    path(String path), pathSegment(String... pathSegments)\n pathëŠ” /ë¶€í„° ì‹œì‘í•˜ë©° /v3/auth/tokensì™€ ê°™ì€ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. pathSegmentëŠ” ê²½ë¡œì˜ ì¡°ê°ì´ë©° auth/tokenê³¼ ê°™ì€ ì¡°ê°ì„ ëœ»í•œë‹¤.    replacePath(String path)\n replacePathëŠ” ì´ë¯¸ ì§€ì •í•œ ê²½ë¡œë¥¼ ì§€ìš°ê³  ìƒˆë¡œ ì§€ì •í•˜ëŠ” ê²ƒì´ë‹¤.    queryParam(String name, Object... values), queryParam(String name, Collection\u0026lt;?\u0026gt; values)\n queryParamì€ ? ë’¤ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì§€ì •í•˜ëŠ” ê²ƒì´ë©°, URIì—ì„œ ?query=http\u0026amp;page=2ì™€ ê°™ì€ í˜•íƒœë‹¤. values ë’¤ì— ì—¬ëŸ¬ ê°œì˜ ê°ì²´ ë˜ëŠ” ê°ì²´ ì»¬ë ‰ì…˜ì„ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ?query=first\u0026amp;query=secondì™€ ê°™ì´ ë¶™ëŠ”ë‹¤.    queryParams(MultiValueMap\u0026lt;String, String\u0026gt; params)\n MultiValueMapìœ¼ë¡œ ìœ„ì˜ íŒŒë¼ë©”í„°ë¥¼ í•œêº¼ë²ˆì— ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš© ì‹œì—” êµ¬í˜„ì²´ì¸ LinkedMultiValueMap í´ë˜ìŠ¤ë¥¼ ê°ì²´ë¡œ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•œë‹¤.    uri(URI uri), uriComponents(UriComponents uriComponents)\n URI ê°ì²´ë‚˜ UriComponents ê°ì²´ë¥¼ í•©ì¹  ìˆ˜ ìˆë‹¤.    UriComponents build(), UriComponents buildAndExpand(Object... uriVariableValues)\n ëª¨ë‘ ë‹¤ ì¡°í•© í›„ build ë©”ì†Œë“œë¥¼ í†µí•´ UriComponents ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. ë§Œì•½ Path ë‚´ {variable}ê³¼ ê°™ì€ í…œí”Œë¦¿ ë³€ìˆ˜ê°€ ìˆë‹¤ë©´ buildAndExpandë¥¼ í†µí•´ ì•ì—ì„œë¶€í„° ìˆœì„œëŒ€ë¡œ ë¬¸ìì—´ì´ë‚˜ toStringì´ ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ì‚½ì…ì‹œí‚¨ë‹¤.    ê¸°íƒ€ ë‹¤ë¥¸ ë©”ì†Œë“œëŠ” JavaDoc ì°¸ì¡°\n  ë§Œì•½ UriComponentsBuilder ê°ì²´ë¥¼ í†µí•´ UriComponents ê°ì²´ë¥¼ ìƒì„±í–ˆë‹¤ë©´, toUri() ë©”ì†Œë“œë¥¼ í†µí•´ ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì‹¤ì œ java.net.URI ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\n1 2 3 4 5  UriComponents hostUriComponents = UriComponentsBuilder.fromHttpUrl(\u0026#34;https://www.example.com\u0026#34;).build(); URI uri = UriComponentsBuilder.fromPath(\u0026#34;/test/{testNumber}\u0026#34;) .uriComponents(hostUriComponents) .queryParam(\u0026#34;query\u0026#34;, \u0026#34;hello\u0026#34;) .buildAndExpand(\u0026#34;1\u0026#34;).toUri();   URI êµ¬ì¡°ê°€ ë³µì¡í•˜ê±°ë‚˜, ì½”ë“œ ë¶„ê¸°ì— ë”°ë¼ URI í˜•íƒœê°€ ë°”ë€Œì–´ì•¼ í•œë‹¤ë©´ UriComponentsBuilder í´ë˜ìŠ¤ë¥¼ ì˜ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ URI ê°ì²´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.\n   ë§ˆì¹˜ë©°  ìŠ¤í”„ë§ì€ HTTP ìš”ì²­ ì‹œì— Spring WebFlux ë‚´ WebClient í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ Spring Framework 5 ë¶€í„´ ê¶Œì¥í•˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ ì„œë¸”ë¦¿ ê¸°ë°˜ìœ¼ë¡œ ê°œë°œí•œ ì½”ë“œ ìœ„ì— WebClient í•˜ë‚˜ ë§Œì„ ìœ„í•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„± ì¶”ê°€ í•˜ëŠ” ê²ƒë„ ì´ìƒí•˜ë‹¤. ë˜í•œ Project Reactor ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë¹„ë™ê¸° ì½”ë“œë¥¼ ì´í•´í•´ì•¼ ì‚¬ìš©í•˜ê¸° ìˆ˜ì›”í•˜ë‹¤.\në”°ë¼ì„œ ì•„ì§ë„ ì„œë¸”ë¦¿ ê¸°ë°˜ ì½”ë“œì—ì„œëŠ” RestTemplate í´ë˜ìŠ¤ê°€ ìì£¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. í•˜ì§€ë§Œ ë¶€ì ì ˆí•˜ê²Œ ì‚¬ìš©ë˜ëŠ” ì¼€ì´ìŠ¤ë¥¼ ë§ì´ ë³´ì•˜ì—ˆë‹¤. ì´ ê¸€ì´ RestTemplate í´ë˜ìŠ¤ë¥¼ ì˜ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ê°€ì´ë“œ ì—­í• ì´ ë˜ì—ˆìœ¼ë©´ í•œë‹¤.\n","date":"Oct 28","permalink":"https://hellomike.page/posts/2021/spring-rest-template-and-request-entity-and-uri/","tags":["java","spring","utils","restful","http","rest-template","okhttp","httpcomponents","uri"],"title":"ìŠ¤í”„ë§ RestTemplate ì˜ í™œìš©í•˜ê¸°"},{"categories":["java","spring"],"contents":"ìŠ¤í”„ë§ì—ëŠ” ìœ ìš©í•œ ë„êµ¬ë“¤ì´ ë§ì´ ì¤€ë¹„ë˜ì–´ìˆë‹¤. í•˜ì§€ë§Œ ì£¼ë³€ì—ì„œëŠ” ê·¸ëŸ° ì¡´ì¬ë¥¼ ëª°ë¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë”°ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ì•˜ë‹¤. ì´ ê¸€ì—ì„œëŠ” ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ StreamUtils, Resource ì¸í„°í˜ì´ìŠ¤ì™€ ê·¸ êµ¬í˜„ì²´ í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ëŠ” íŒë“¤ì„ ì‘ì„±í–ˆë‹¤.\n   StreamUtils ìœ í‹¸ í´ë˜ìŠ¤   Spring Framework StreamUtils JavaDoc Spring Framwork 3.2.2 ë¶€í„° ì‚¬ìš© ê°€ëŠ¥  ì´ ìœ í‹¸ í´ë˜ìŠ¤ëŠ” ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ ë‚´ì— ë‚´ì¥ë˜ì–´ ìˆê³ , Java Input/Output Streamì„ ë‹¤ë£¨ê¸° ìœ„í•œ ê²ƒì´ë‹¤. ì‹¤ì œë¡œ ìë°”ì—ì„œ Input/Output Stream ë‹¤ë£¨ê¸°ì—” ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸(ì‚¬ì „ ì¤€ë¹„) ì½”ë“œë“¤ì´ ë§ë‹¤.\nì•„ë˜ëŠ” InputStreamì„ Stringìœ¼ë¡œ ë°”ê¾¸ëŠ” ì½”ë“œì´ë‹¤.\n ì½”ë“œ ì¶œì²˜ : How do I read / convert an InputStream into a String in Java? - Stack Overflow  1 2 3 4 5 6 7 8 9 10 11 12  // ê°€ì¥ ë¹ ë¥´ë‹¤ë˜ ByteArrayOutputStream ì´ìš©: https://stackoverflow.com/a/35446009 public String streamToString(InputStream inputStream) throws IOException { ByteArrayOutputStream result = new ByteArrayOutputStream(); byte[] buffer = new byte[1024]; for (int length; (length = inputStream.read(buffer)) != -1; ) { result.write(buffer, 0, length); } // JDK 1.7 ë¯¸ë§Œ ì‚¬ìš© ì‹œ \u0026#34;UTF-8\u0026#34;ë¡œ ëŒ€ì²´  return result.toString(StandardCharsets.UTF_8.name()); } ... String str = streamToString(inputStream);   ë¬¼ë¡  ìœ„ ì½”ë“œë¥¼ ìœ í‹¸í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ êµ¬í˜„í•˜ëŠ” ë°©ë²•ë„ ê´œì°®ë‹¤. Java ë‚´ì—ì„  ê°€ì¥ ë¹ ë¥¸ ì½”ë“œì´ê¸° ë•Œë¬¸ì´ë‹¤. í•˜ì§€ë§Œ ì € ì½”ë“œê°€ ìƒê°ë‚˜ì§€ ì•Šì„ ë•ŒëŠ” ì–´ë–»ê²Œ í• ê¹Œ? ì•„ë‹ˆë©´ Stringì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ í˜•íƒœë¡œ ë°›ê³  ì‹¶ë‹¤ë©´? commons-io ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ IOUtils ìœ í‹¸ í´ë˜ìŠ¤ì™€ ë¹„ìŠ·í•˜ê²Œ, ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ëŠ” ì´ë¯¸ StreamUtils ìœ í‹¸ í´ë˜ìŠ¤ë¥¼ ì¤€ë¹„í•´ë‘ì—ˆë‹¤.\n1 2 3 4  import org.springframework.util.StreamUtils; import java.nio.charset.StandardCharsets; ... String str = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);      ìì£¼ ì“°ëŠ” ë©”ì†Œë“œ    static byte[] copyToByteArray(InputStream in)\n InputStreamì„ byte ë°°ì—´ë¡œ ë°˜í™˜í•œë‹¤.    static String copyToString(InputStream in, Charset charset)\n InputStreamì„ ë¬¸ìì—´ë¡œ ë°˜í™˜í•œë‹¤.    static InputStream emptyInput()\n ë¹ˆ InputStreamì„ ë°˜í™˜í•œë‹¤.    1ë²ˆì¸ InputStreamì„ Byte ë°°ì—´ë¡œ ë³€í™˜í•˜ëŠ” ë©”ì†Œë“œì™€ 2ë²ˆì¸ InputStreamì„ Stringìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë©”ì†Œë“œê°€ ê°€ì¥ ë§ì´ ì“°ì¼ ê²ƒì´ë‹¤.\nIO ì²˜ë¦¬ ì‹œì—ëŠ” íŠ¹íˆë‚˜ byte ë°°ì—´ì„ ì²˜ë¦¬í•  ì¼ì´ ë§ë‹¤. Base64 ì¸ì½”ë”©ì„ í•˜ê±°ë‚˜ ì†Œì¼“ì„ ì‚¬ìš©í•  ë•Œì—ë„ byte ë°°ì—´ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.\n3ë²ˆì¸ emptyInput() ë©”ì†Œë“œëŠ” ì–¼í• ë³´ë©´ ë¬´ê°€ì¹˜ í•  ê²ƒ ê°™ì§€ë§Œ ì˜ì™¸ì˜ ìœ ìš©ì„±ì´ ë†’ì€ë°, InputStreamì„ ë§¤ê°œë³€ìˆ˜ë¡œ ì£¼ê±°ë‚˜ ë°˜í™˜í•  ë•Œ null ëŒ€ì‹  ì“°ì´ê¸° ì¢‹ì„ ê²ƒì´ë‹¤.\n   í‘œì¤€ ë¬¸ìì…‹   java.nio.charset.StandardCharsets JavaDoc  ì ê¹ ì§šê³  ë„˜ì–´ê°ˆ í‘œì¤€ ë¬¸ìì…‹ì€ JDK 1.7ë¶€í„° ì¡´ì¬í•œë‹¤. ì‹¤ì œë¡œ 1.7 ì´ì „ì—ëŠ” ë¬¸ìì…‹ ì„¤ì •ì„ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë°›ì•˜ì—ˆë‹¤.\n1 2  String str = new String(byteArray, \u0026#34;UTF-8\u0026#34;); String str = new String(byteArray, Charset.forName(\u0026#34;UTF-8\u0026#34;));   ì´ëŸ° ì‹ìœ¼ë¡œ ì²˜ë¦¬ í–ˆì–´ì•¼ í–ˆëŠ”ë°, ë¬¸ì œëŠ” String íƒ€ì…ì˜ ë§¤ê°œë³€ìˆ˜ì˜ ë¬¸ìì…‹ ì½”ë“œê°€ ì˜ëª» ì…ë ¥í–ˆì„ ë•Œì´ë‹¤. ê·¸ë• UnsupportEncodingExceptionìœ¼ë¡œ ì¸í•´ í”„ë¡œê·¸ë¨ì´ ì¤‘ë‹¨ëœë‹¤. IOExceptionì˜ ìì‹ í´ë˜ìŠ¤ì—¬ì„œ ë” ì‹¬ê°í–ˆë‹¤.\nê·¸ë˜ì„œ í‘œì¤€ ë¬¸ìì…‹ ê°ì²´ ìƒìˆ˜ë¥¼ StandardCharsets í´ë˜ìŠ¤ì— ì •ì˜í•˜ì˜€ë‹¤. ë”°ë¼ì„œ ì´ì œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.\n1  String str = new String(byteArray, StandardCharsets.UTF_8);   ë§Œì•½, EUC-KRì„ ì“°ê³  ì‹¶ë‹¤ë©´? Exceptionì„ ì²˜ë¦¬í•´ì•¼ í•  ìœ„í—˜ì„±ì´ ê³„ì† ì¡´ì¬í•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ í•´ì•¼ í•œë‹¤.\n1  String str = new String(byteArray, Charset.forName(\u0026#34;EUC-KR\u0026#34;));      FileCopyUtils ìœ í‹¸ í´ë˜ìŠ¤   Spring Framework FileCopyUtils JavaDoc  ìœ„ì˜ StreamUtils ìœ í‹¸ í´ë˜ìŠ¤ëŠ” ë²„ì „ 3.2.2 ë¶€í„° ìƒê¸´ ë°˜ë©´, FileCopyUtilsëŠ” ì´ˆê¸° ë²„ì „ì—ë„ ì¡´ì¬í–ˆë‹¤. ìœ í‹¸ í´ë˜ìŠ¤ ì´ë¦„ ê·¸ëŒ€ë¡œ íŒŒì¼ì„ ë³µì‚¬í•˜ëŠ” ì •ì  ë©”ì†Œë“œê°€ ë‹´ê²¨ìˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ JavaDocì„ ì°¸ì¡° ë°”ë€ë‹¤.\në¬¼ë¡  JDK 1.7ì´ìƒì´ë¼ë©´ java.nio.file.Files í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì¢‹ë‹¤. ë” í¸ë¦¬í•˜ê³  ë‹¤ì–‘í•œ ìœ í‹¸ë¦¬í‹° ì •ì  ë©”ì†Œë“œë“¤ì´ ì¡´ì¬í•œë‹¤.\n   Resource ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´   Spring Framework Manual Spring Framework Resource JavaDoc  ResourceëŠ” ì¸í„°í˜ì´ìŠ¤ë‹¤. ê·¸ëƒ¥ ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ê³  ë‹¤ìŒê³¼ ê°™ì€ êµ¬í˜„ëœ í´ë˜ìŠ¤ê°€ ì¡´ì¬í•œë‹¤.\n UrlResource ClassPathResource FileSystemResource PathResource ServletContextResource InputStreamResource ByteArrayResource  jarê³¼ ê°™ì´ ë¬¶ì´ëŠ” íŒŒì¼ì€ ClassPathResourceë¥¼ ì´ìš©í•˜ê³ , ì¼ë°˜ì ì¸ íŒŒì¼ì„ ì½ì–´ì˜¬ ë• FileSystemResource ë¥¼ ì‚¬ìš©í•œë‹¤. ë”°ë¼ì„œ ë¦¬ì†ŒìŠ¤ì— í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì €ì¥í•˜ê³  ì½ì–´ì˜¤ê³  ì‹¶ì„ ë• ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\n1 2 3 4 5 6 7  import org.springframework.core.io.Resource; import org.springframework.core.io.ClassPathResource; import org.springframework.util.StreamUtils; import java.nio.charset.StandardCharsets; ... Resource resource = new ClassPathResource(\u0026#34;load.txt\u0026#34;); String loaded = StreamUtils.copyToString(resource.getInputStream(), StandardCharsets.UTF_8);   ê°„í¸í•œ ë°©ë²•ì´ì§€ë§Œ ì´ê±´ ê²½ë¡œë¥¼ ì§ì ‘ í•˜ë“œì½”ë”© í•´ì•¼í•˜ëŠ” ë‹¨ì ë„ ì¡´ì¬í•œë‹¤. ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ëŠ” ì´ìœ ê°€ ê°•ë ¥í•œ Dependency Injection(ì˜ì¡´ ì£¼ì…)ì— ì˜í•œ IoC ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš© í•˜ê¸° ìœ„í•¨ë„ ìˆì„ ê²ƒì´ë‹¤.\níŠ¹íˆ ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ application.properties (ë˜ëŠ” yaml)ì˜ ì¡´ì¬ë¥¼ ì•Œ ê²ƒì´ë‹¤. propertiesì™€ @Value ì• ë…¸í…Œì´ì…˜ì˜ ì¡°í•©ìœ¼ë¡œ DIë¥¼ ì´ìš©í•´ ë¶ˆëŸ¬ ì˜¬ ìˆ˜ë„ ìˆë‹¤.\nload.resource=classpath:load.txt 1 2 3 4 5 6 7 8 9 10 11 12 13 14  @Component public class LoadResource { private final String loaded; @Autowired public LoadResource(@Value(\u0026#34;${load.resource}\u0026#34;) Resource loaded) { this.loaded = StreamUtils.copyToStream(loaded.getInputStream(), StandardCharsets.UTF_8); } public String getLoaded() { return loaded; } }   ë˜ëŠ” ì´ì™€ ê°™ì´ Value ì• ë…¸í…Œì´ì…˜ì— í•˜ë“œì½”ë”©í•˜ì—¬ ë„£ì„ ìˆ˜ë„ ìˆë‹¤.\n1  @Value(\u0026#34;classpath:load.txt\u0026#34;)      ë§ˆì¹˜ë©°  ë¬¼ë¡  ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„, Javaë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì•„ë˜ì™€ ê°™ì€ ì¹œìˆ™í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ìˆë‹¤.\n  commons-io\n1  String str = IOUtils.toString(inputStream, StandardCharsets.UTF_8);     Guava\n InputStreamì„ Stringìœ¼ë¡œ ë³€í™˜.  1 2 3 4 5 6 7  ByteSource source = new ByteSource() { @Override public InputStream openStream() throws IOException { return inputStream; } }; String str = source.asCharSource(StandardCharsets.UTF_8).read();    classpath ë‚´ íŒŒì¼ì„ ì½ì–´ Stringìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°.  1  String str = Resources.toString(Resources.getResource(\u0026#34;load.txt\u0026#34;), StandardCharsets.UTF_8);     JDK 9 ì´ìƒ\n1  String str = new String(inputStream.readAllBytes(), StandardCharsets.UTF_8);     Apache Commonsì™€ Google GuavaëŠ” ë‘˜ ë‹¤ ë§ì´ ì°¾ê³  ì“°ëŠ” ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¬¶ìŒë“¤ì´ë‹¤. IOë¶€ë¶„ì€ commons-io ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê°„í¸í•˜ê³  ê°•ë ¥í•œ í¸ì´ì§€ë§Œ ê°œì¸ì ìœ¼ë¡  Guavaê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬ì„±ì´ ì¢‹ì•„ ì„ í˜¸í•œë‹¤.\nìµœê·¼ JDK ë²„ì „ë“¤ì€ ìœ í‹¸ í´ë˜ìŠ¤ ë“±ë„ ê°•í™”ê°€ ë§ì´ ë˜ì–´, íŠ¹ì • ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ì–´ë„ ê°œë°œì´ ë§ì´ í¸í•´ì¡Œë‹¤. ê·¸ë˜ë„ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ ê°•ë ¥í•œ ê¸°ëŠ¥ê³¼ ì—®ì–´ ì‚¬ìš©í•˜ë©´ ë”ìš± ë” ê°•ë ¥í•˜ê³  ê°ì²´ì§€í–¥ì ì´ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\n","date":"Oct 23","permalink":"https://hellomike.page/posts/2021/spring-utils-io-resources/","tags":["java","spring","io","utils","resources","streamutils","classpath"],"title":"ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ StreamUtils, Resourceë¥¼ ì´ìš©í•´ íŒŒì¼ ì½ì–´ì˜¤ê¸°"},{"categories":null,"contents":"   Hello, Mike!  ì•ˆë…•í•˜ì„¸ìš”. Mikeì…ë‹ˆë‹¤. ì €ëŠ” Web ê¸°ìˆ ì„ ë°”íƒ•ìœ¼ë¡œ ê°œë°œí•˜ëŠ” íšŒì‚¬ì˜ ì‚¬ì›ì…ë‹ˆë‹¤. íŠ¹íˆ Java, Springì˜ ë°±ì—”ë“œì™€ Typescript, React.jsì˜ í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë°˜ ê¸°ìˆ ì„ ë‹¤ë£¹ë‹ˆë‹¤. ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ Kubernetesì™€ ê°™ì€ ì»¨í…Œì´ë„ˆ ê°€ìƒí™” ê¸°ë°˜ í´ë¼ìš°ë“œ ê¸°ìˆ ë“¤ë„ ë‹¤ë£¹ë‹ˆë‹¤.\nê°œì¸ì ìœ¼ë¡œëŠ” ë¨¹ëŠ” ê²ƒ, ë“£ëŠ” ê²ƒ, ì½ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ë…¸ë˜, ë§›ì§‘, ì†Œì„¤ë“¤ë„ ê¸°íšŒê°€ ëœë‹¤ë©´ ë¸”ë¡œê·¸ì— ì“¸ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.\n   ë¸”ë¡œê·¸ ì†Œê°œ  ê°œë°œì„ ì²˜ìŒ ì‹œì‘ í•  ë•Œ, ìš°ë¦¬ê°€ ì²˜ìŒ ì“°ë˜ ê·¸ ì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤.\n1 2 3 4 5 6  #include \u0026lt;stdio.h\u0026gt; int main(int argc, char** argv) { printf(\u0026#34;Hello, world!\u0026#34;); return 0; }   \u0026lsquo;ë°ë‹ˆìŠ¤ ë¦¬ì¹˜\u0026rsquo;, \u0026lsquo;ë¸Œë¼ì´ì–¸ W. ì»¤ë‹ˆí•¸\u0026rsquo;ì˜ The C Programming Languageì—ì„œ ì‹œì‘ëœ \u0026lsquo;Hello, world!\u0026lsquo;ëŠ” ì´ì œëŠ” í”„ë¡œê·¸ë˜ë°ì„ ê³µë¶€í•œë‹¤ë©´ í•œ ë²ˆì”© ì½˜ì†”ì— ë„ì–´ë³´ëŠ” ê²½í—˜ì„ í•©ë‹ˆë‹¤. ë¸”ë¡œê·¸ ì œëª©ì€ ê·¸ê²ƒì—ì„œ ì˜ê°ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.\nì´ ë¸”ë¡œê·¸ëŠ” ê°œë°œìë¡œì„œ ê³µë¶€í•˜ë©° ë°°ìš´ ê²ƒë“¤ì„ ë‚¨ê¸°ê³ ì ì‹œì‘í•©ë‹ˆë‹¤. ë³„ ê²ƒ ì•„ë‹Œ ê¸€ì¼ ìˆ˜ ìˆì§€ë§Œ, ì œ ìì‹ ì˜ ê¸°ì–µì— ì¡°ê¸ˆ ë” ë‚¨ê¸°ê³ ì ì ëŠ” ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.\nì €ëŠ” í˜„ì¬ëŠ” ì›¹ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì—…í•˜ëŠ” ê°œë°œìì…ë‹ˆë‹¤. ì¼ë‹¨ í”„ë¡ íŠ¸ì—”ë“œ, ë°±ì—”ë“œ, ì¸í”„ë¼, ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì£¼ ì¢…ëª©ìœ¼ë¡œ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì–¸ì  ê°„ ë‹¤ë¥¸ ë¶„ì•¼ì—ì„œ ì¼í•  ìˆ˜ë„ ìˆê² ì§€ë§Œ ì‹œì‘ì ì—ì„œ ëª‡ë…„ê°„ì€ ì›¹ ê¸°ë°˜ì„ ì£¼ ëª©ì ìœ¼ë¡œ ê¸€ì„ ì“¸ ê²ƒì…ë‹ˆë‹¤.\nì´ ë¸”ë¡œê·¸ë¥¼ ì°¾ì•„ì£¼ì‹  ë¶„ë“¤ ëª¨ë‘ ê°ì‚¬ë“œë¦¬ë©°, íŠ¹íˆ ì´ ê¸€ì„ ë³´ê³  ê³„ì‹ ë‹¤ë©´, ë”ìš± ë” ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.\n   ë¸”ë¡œê·¸ êµ¬ì„±  ì´ ë¸”ë¡œê·¸ëŠ” Hugoë¡œ êµ¬ì„±í–ˆìœ¼ë©°, Github Actionsë¥¼ ì´ìš©í•˜ì—¬ ë¹Œë“œ í›„, Github Pagesì—ì„œ ì„œë¹„ìŠ¤ ì¤‘ì…ë‹ˆë‹¤.\në¸”ë¡œê·¸ì˜ Faviconì€ Emojiì˜ \u0026lsquo;ğŸ‘‹'ë¥¼ Noto Emojiì˜ í˜•íƒœë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. Favicon ë¼ì´ì„¼ìŠ¤ëŠ” Noto Emojiì˜ Apache License 2.0ì„ ë”°ë¦…ë‹ˆë‹¤.\në¸”ë¡œê·¸ì˜ ì› ì†ŒìŠ¤ ë ˆí¬ì§€í† ë¦¬ëŠ” mike-kwak/blogì—ì„œ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nëŒ“ê¸€ì€ Giscusë¥¼ ì‚¬ìš©í•˜ë©°, ë¸”ë¡œê·¸ ì†ŒìŠ¤ ë ˆí¬ì§€í† ë¦¬ì˜ Github Discussionsì™€ ì—°ë™ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\në¸”ë¡œê·¸ì˜ í…Œë§ˆëŠ” Hugo Taniaë¥¼ ì‚¬ìš©í•˜ì˜€ìœ¼ë©°, ì œê°€ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì¼ë¶€ ì»¤ìŠ¤í…€í•œ ê²°ê³¼ë¬¼ì´ ìˆìŠµë‹ˆë‹¤.\n   ë¼ì´ì„ ìŠ¤  mike-kwak/blog ë‚´ ë¬¸ì„œë¥¼ ì œì™¸í•œ ë‚´ë¶€ ì½”ë“œ ë“¤ì€ MIT ë¼ì´ì„ ìŠ¤ë¥¼ ì ìš©í•©ë‹ˆë‹¤.\në¸”ë¡œê·¸ì˜ ê¸€ì€ CC-BY 4.0ë¥¼ ì ìš©í•©ë‹ˆë‹¤. ë¸”ë¡œê·¸ ê¸€ ë‚´ì—ì„œ ì¶œì²˜ê°€ ë”°ë¡œ ì—†ëŠ” ì œê°€ ì‘ì„±í•œ ì˜ˆì‹œ ì½”ë“œë“¤ì€ Public Domainì´ë¯€ë¡œ ì €ì‘ê¶Œì„ êµ³ì´ í‘œê¸° ì•ˆí•˜ì…”ë„ ììœ ë¡­ê²Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\n","date":"Oct 23","permalink":"https://hellomike.page/about/","tags":null,"title":"ì†Œê°œ"},{"categories":null,"contents":"","date":"Jan 01","permalink":"https://hellomike.page/articles/","tags":null,"title":"ê¸€ ëª©ë¡"}]